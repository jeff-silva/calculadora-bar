import{K as j,r as G,L,M as Q,o as i,u as v,V as w,A as W,B as z,n as T,N as J,w as l,z as K,y as X,b as t,v as u,F as Y,d as I,q as $,E as Z,O as q,J as h,G as B,c as m,P as b,Q as x,a as d,x as V,R as E,S as H,t as r,T as ee,U as P,W as F,X as D,Y as M,Z as O,_ as g,$ as te}from"./entry.52cb716d.js";import{_ as ae}from"./nuxt-layout.584e074e.js";import{u as le}from"./useFirebase.a57e9906.js";import{u as ne}from"./useForm.649a2d49.js";const se={__name:"money",props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup(A,{emit:p}){const y=A,C=p,U=a=>Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(a).replace(" €",""),N=j({get:()=>U(y.modelValue),set:a=>{f&&(f.masked.value=s.value,f.updateOptions(R),f._onChange(),a=parseFloat((a||"").replace(/[^0-9]/g,""))/100,C("update:modelValue",a))}}),c=G(null);let f,s,R={mask(a){this._value=U((a||"").replace(/[^0-9]/g,"")/100)}};return L(()=>{const a=c.value.$el;s=a.tagName=="INPUT"?a:a.querySelector("input"),f=Q(s,R)}),(a,n)=>(i(),v(w,{modelValue:N.value,"onUpdate:modelValue":n[0]||(n[0]=_=>N.value=_),ref_key:"inputRef",ref:c},null,8,["modelValue"]))}};class k{static money(p,y="BRL",C="pt-BR"){return typeof p=="string"&&(p=parseInt(p.replace(/[^0-9]/g,""))/100),isNaN(p)&&(p=0),Intl.NumberFormat(C,{style:"currency",currency:y}).format(p)}static date(p){return p}static timeago(p){return p}}const ue=d("br",null,null,-1),de={key:0,class:"text-center text-disabled"},oe={class:"d-flex justify-end"},ie={key:0,class:"text-center bg-grey-lighten-4 py-3 text-disabled rounded"},re={class:"d-flex justify-end"},me={key:0,class:"text-center bg-grey-lighten-4 py-3 text-disabled rounded"},pe=d("br",null,null,-1),ce={class:"d-flex justify-end"},fe=d("br",null,null,-1),_e={class:"pa-3 text-right mb-2 elevation-1 rounded"},ye={class:"font-weight-bold"},he={key:1},Ve=d("br",null,null,-1),ve=d("colgroup",null,[d("col",{width:"*"}),d("col",{width:"100"}),d("col",{width:"80"}),d("col",{width:"150"})],-1),be={class:"py-2"},xe={class:"d-block text-disabled"},ge=d("br",null,null,-1),ke=d("colgroup",null,[d("col",{width:"*"}),d("col",{width:"150"})],-1),Ce=d("td",{class:"text-right"},"Total:",-1),Ie={__name:"[id]",props:{modelValue:{type:[String],default:""}},emits:["update:modelValue"],async setup(A,{emit:p}){let y,C;const U=W(),N=z(),c=le(),f=T({value:"info",set(a){this.value=a}}),s=ne({data:{uid:!1,ownerUID:c.user.uid,name:"",users:[],purchases:[],admins:[]},async onSubmit(){const a=await c.firestore.save("division",this.data);N.push(`/division/${a.uid}`)},uid(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,a=>(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16))},focus:!1,async userAdd(){const a=this.uid(),n=`Pessoa #${this.data.users.length+1}`;this.data.users.push(this.focus={uid:a,name:n})},async userRemove(a){if(!confirm(`Remover ${a.name}?`))return;const n=this.data.users.indexOf(a);this.data.users.splice(n,1)},async purchaseAdd(){const a=this.uid(),n=`Item #${this.data.purchases.length+1}`;this.data.purchases.push(this.focus={uid:a,name:n,amount:0,quantity:1,divideBy:[]})},async purchaseRemove(a){if(!confirm(`Remover ${a.name}?`))return;const n=this.data.purchases.indexOf(a);this.data.purchases.splice(n,1)},async adminAdd(){const a=this.uid();this.data.admins.push({uid:a,email:""})},async adminRemove(a){if(!confirm(`Remover ${a.email}?`))return;const n=this.data.admins.indexOf(a);this.data.admins.splice(n,1)},result:j(()=>{let a={total:0};return a.total=s.data.purchases.reduce((n,_)=>n+_.amount*_.quantity,0),a.division=s.data.users.map(n=>{const _=s.data.purchases.filter(e=>e.divideBy.includes(n.uid)).map(e=>({total:e.amount*e.quantity/e.divideBy.length,purchase:e}));return{total:_.reduce((e,o)=>e+o.total,0),user:n,purchases:_}}),a})});if(U.params.id!="new"){const a=([y,C]=J(()=>c.firestore.find("division",U.params.id)),y=await y,C(),y);s.fill({...s.data,...a}),c.firestore.onSnapshot("division",U.params.id,n=>{s.fill({...s.data,...n.data()})})}const R=T({edit(){return c.user?!!(s.data.ownerUID==c.user.uid||s.data.admins.filter(a=>a.email==c.user.email)):!1}});return(a,n)=>{const _=se,S=ae;return i(),v(S,{name:"app"},{main:l(()=>[R.edit()?(i(),v(K,{key:0,onSubmit:n[9]||(n[9]=X(e=>u(s).submit(),["prevent"]))},{default:l(()=>[t(Z,null,{default:l(()=>[u(s).success?(i(),v(Y,{key:0,type:"success",class:"mb-6"},{default:l(()=>[I("Dados salvos")]),_:1})):$("",!0)]),_:1}),t(H,{modelValue:f.value,"onUpdate:modelValue":n[5]||(n[5]=e=>f.value=e)},{default:l(()=>[t(q,{value:"info"},{default:l(()=>[t(h,{subtitle:"Informações principais"},{default:l(()=>[t(B,null,{default:l(()=>[t(w,{label:"Nome do evento",modelValue:u(s).data.name,"onUpdate:modelValue":n[0]||(n[0]=e=>u(s).data.name=e)},null,8,["modelValue"])]),_:1})]),_:1}),ue,t(h,{subtitle:"Colaboradores"},{default:l(()=>[t(B,null,{default:l(()=>[u(s).data.admins.length==0?(i(),m("div",de," Nenhum colaborador criado ")):$("",!0),(i(!0),m(x,null,b(u(s).data.admins,e=>(i(),v(w,{modelValue:e.email,"onUpdate:modelValue":o=>e.email=o,label:"E-mail","append-inner-icon":"mdi-delete","onClick:appendInner":o=>u(s).adminRemove(e)},null,8,["modelValue","onUpdate:modelValue","onClick:appendInner"]))),256))]),_:1}),d("div",oe,[t(V,{color:"primary",text:"Add","prepend-icon":"mdi-plus",onClick:n[1]||(n[1]=e=>u(s).adminAdd()),rounded:"0"})])]),_:1})]),_:1}),t(q,{value:"users"},{default:l(()=>[t(h,{subtitle:"Pessoas"},{default:l(()=>[t(B,{class:"d-flex flex-column",style:{gap:"20px"}},{default:l(()=>[u(s).data.users.length==0?(i(),m("div",ie," Nenhuma pessoa criada ")):$("",!0),(i(!0),m(x,null,b(u(s).data.users,e=>(i(),v(w,{modelValue:e.name,"onUpdate:modelValue":o=>e.name=o,label:"Nome do participante","hide-details":!0,"append-inner-icon":u(c).user?"mdi-delete":null,"onClick:appendInner":o=>u(s).userRemove(e)},null,8,["modelValue","onUpdate:modelValue","append-inner-icon","onClick:appendInner"]))),256))]),_:1}),d("div",re,[t(V,{color:"primary",text:"Add","prepend-icon":"mdi-plus",onClick:n[2]||(n[2]=e=>u(s).userAdd()),rounded:"0"})])]),_:1})]),_:1}),t(q,{value:"purchases"},{default:l(()=>[t(h,{subtitle:"Gastos"},{default:l(()=>[u(s).data.purchases.length==0?(i(),m("div",me," Nenhum gasto criado ")):$("",!0),t(E,{modelValue:u(s).focus,"onUpdate:modelValue":n[3]||(n[3]=e=>u(s).focus=e)},{default:l(()=>[(i(!0),m(x,null,b(u(s).data.purchases,e=>(i(),v(F,{value:e},{default:l(()=>[t(D,null,{default:l(()=>[I(r(e.name),1)]),_:2},1024),t(M,null,{default:l(()=>[pe,t(O,null,{default:l(()=>[t(g,{cols:"12"},{default:l(()=>[t(w,{modelValue:e.name,"onUpdate:modelValue":o=>e.name=o,label:"Produto","hide-details":!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(g,{cols:"12",md:"8"},{default:l(()=>[t(_,{modelValue:e.amount,"onUpdate:modelValue":o=>e.amount=o,label:"Preço","hide-details":!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(g,{cols:"12",md:"4"},{default:l(()=>[t(w,{modelValue:e.quantity,"onUpdate:modelValue":o=>e.quantity=o,modelModifiers:{number:!0},label:"Quant.",type:"number","hide-details":!0,"prepend-inner-icon":u(c).user?"mdi-minus":null,"append-inner-icon":u(c).user?"mdi-plus":null,"onClick:prependInner":o=>e.quantity=Math.max(1,e.quantity-1),"onClick:appendInner":o=>e.quantity++},null,8,["modelValue","onUpdate:modelValue","prepend-inner-icon","append-inner-icon","onClick:prependInner","onClick:appendInner"])]),_:2},1024),t(g,{cols:"12"},{default:l(()=>[t(te,{modelValue:e.divideBy,"onUpdate:modelValue":o=>e.divideBy=o,label:"Quem vai consumir?",multiple:"",items:u(s).data.users,"item-value":"uid","item-title":"name","hide-details":!0},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(g,{cols:"12"},{default:l(()=>[t(V,{color:"error",onClick:o=>u(s).purchaseRemove(e),"prepend-icon":"mdi-delete"},{default:l(()=>[I("Deletar")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),d("div",ce,[t(V,{color:"primary",text:"Add","prepend-icon":"mdi-plus",onClick:n[4]||(n[4]=e=>u(s).purchaseAdd()),rounded:"0"})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),fe,t(h,{subtitle:"Resultados"},{default:l(()=>[t(B,null,{default:l(()=>[d("div",_e,"Total: "+r(u(s).result.total),1),t(E,null,{default:l(()=>[(i(!0),m(x,null,b(u(s).result.division,e=>(i(),v(F,null,{default:l(()=>[t(D,null,{default:l(()=>[t(O,null,{default:l(()=>[t(g,{cols:"6"},{default:l(()=>[I(r(e.user.name),1)]),_:2},1024),t(g,{cols:"6"},{default:l(()=>[I(r(u(k).money(e.total)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(M,{style:{margin:"-6px -24px -14px"}},{default:l(()=>[t(P,null,{default:l(()=>[d("tbody",null,[(i(!0),m(x,null,b(e.purchases,o=>(i(),m("tr",null,[d("td",null,r(o.purchase.name),1),d("td",null,r(u(k).money(o.purchase.amount)),1),d("td",null,"/ "+r(o.purchase.divideBy.length),1),d("td",ye,"= "+r(u(k).money(o.total)),1)]))),256))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1}),t(ee,null,{default:l(()=>[t(V,{text:"Info",stacked:"","prepend-icon":"material-symbols:info-outline",onClick:n[6]||(n[6]=e=>f.set("info"))}),t(V,{text:"Pessoas",stacked:"","prepend-icon":"material-symbols:frame-person",onClick:n[7]||(n[7]=e=>f.set("users"))}),t(V,{text:"Gastos",stacked:"","prepend-icon":"solar:chat-round-money-outline",onClick:n[8]||(n[8]=e=>f.set("purchases"))}),t(V,{text:"Salvar",stacked:"",type:"submit",color:"primary","prepend-icon":"mdi-check"})]),_:1})]),_:1})):$("",!0),R.edit()?$("",!0):(i(),m("div",he,[t(h,{subtitle:u(s).data.name},null,8,["subtitle"]),Ve,t(h,{subtitle:"Consumos"},{default:l(()=>[t(P,null,{default:l(()=>[ve,d("tbody",null,[(i(!0),m(x,null,b(u(s).data.purchases,e=>(i(),m("tr",null,[d("td",be,[d("div",null,r(e.name),1),d("small",xe," Consumido por "+r(u(s).data.users.filter(o=>e.divideBy.includes(o.uid)).map(o=>o.name).join(", ")),1)]),d("td",null,r(u(k).money(e.amount)),1),d("td",null,"x "+r(e.quantity),1),d("td",null,r(u(k).money(e.amount*e.quantity)),1)]))),256))])]),_:1})]),_:1}),ge,t(h,{subtitle:"Divisão"},{default:l(()=>[t(P,null,{default:l(()=>[ke,d("tbody",null,[(i(!0),m(x,null,b(u(s).result.division,e=>(i(),m("tr",null,[d("td",null,r(e.user.name),1),d("td",null,r(u(k).money(e.total)),1)]))),256)),d("tr",null,[Ce,d("td",null,r(u(k).money(u(s).result.total)),1)])])]),_:1})]),_:1})]))]),_:1})}}};export{Ie as default};
