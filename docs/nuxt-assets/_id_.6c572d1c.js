import{o as u,c as V,b as e,J as D,w as l,K as L,a as t,L as I,M as q,t as C,v as o,u as R,G as F,N as T,q as S,O as W,n as Q,P as K,Q as X,R as O,S as j,x as k,T as Y,U as P,r as Z,W as ee,X as te,V as B,Y as ae,E as le,F as se,d as M,Z as ne,_ as oe,$ as G,a0 as H,a1 as de,a2 as z,a3 as J,I as ie,a4 as ue,a5 as E,a6 as re,a7 as me,a8 as ce,a9 as pe,y as fe,z as _e,m as ye,A as ve,B as Ve}from"./entry.104bfb7b.js";import{u as he,a as be}from"./index.28648770.js";import{u as ge}from"./useFirebase.a4571b8d.js";import{u as xe}from"./useForm.aef98d99.js";import{_ as ke}from"./nuxt-layout.559a63ae.js";class N{static money(c,f="BRL",y="pt-BR"){return typeof c=="string"&&(c=parseInt(c.replace(/[^0-9]/g,""))/100),isNaN(c)&&(c=0),Intl.NumberFormat(y,{style:"currency",currency:f}).format(c)}static date(c){return c}static timeago(c){return c}}const $e=t("br",null,null,-1),Ce=t("colgroup",null,[t("col",{width:"*"}),t("col",{width:"100"})],-1),Re={class:"py-2"},Se={class:"d-block text-disabled"},Ue={class:"py-2"},Ie={class:"d-block"},we={class:"d-block"},Be={class:"d-block border-t"},Ne=t("br",null,null,-1),Te=t("colgroup",null,[t("col",{width:"*"}),t("col",{width:"100"})],-1),qe=t("td",{class:"text-right"},"Total:",-1),Pe={__name:"view",props:{form:{type:[Object],default:()=>({})}},emits:["update:modelValue"],setup(h,{emit:c}){return(f,y)=>(u(),V("div",null,[e(D,{subtitle:h.form.data.name},null,8,["subtitle"]),$e,e(D,{subtitle:"Consumos"},{default:l(()=>[e(L,null,{default:l(()=>[Ce,t("tbody",null,[(u(!0),V(I,null,q(h.form.data.purchases,m=>(u(),V("tr",null,[t("td",Re,[t("div",null,C(m.name),1),t("small",Se," Consumido por "+C(h.form.data.users.filter(g=>m.divideBy.includes(g.uid)).map(g=>g.name).join(", ")),1)]),t("td",Ue,[t("small",Ie,C(m.quantity)+" x",1),t("small",we,C(("format"in f?f.format:o(N)).money(m.amount)),1),t("small",Be,C(("format"in f?f.format:o(N)).money(m.amount*m.quantity)),1)])]))),256))])]),_:1})]),_:1}),Ne,e(D,{subtitle:"Divisão"},{default:l(()=>[e(L,null,{default:l(()=>[Te,t("tbody",null,[(u(!0),V(I,null,q(h.form.result.division,m=>(u(),V("tr",null,[t("td",null,C(m.user.name),1),t("td",null,[t("small",null,C(("format"in f?f.format:o(N)).money(m.total)),1)])]))),256)),t("tr",null,[qe,t("td",null,[t("small",null,C(("format"in f?f.format:o(N)).money(h.form.result.total)),1)])])])]),_:1})]),_:1})]))}},Ae={key:1},Ee={class:"d-flex align-items justify-end",style:{gap:"2px",background:"#f7f7f708"}},De={__name:"card",props:{cardText:{type:[Boolean],default:!0}},setup(h){const c=h,f={VBtn:{rounded:0,height:35}};return(y,m)=>(u(),R(D,{elevation:"3",class:"ma-1"},{default:l(()=>[c.cardText?(u(),R(F,{key:0},{default:l(()=>[T(y.$slots,"default")]),_:3})):S("",!0),c.cardText?S("",!0):(u(),V("div",Ae,[T(y.$slots,"default")])),e(W,{defaults:f},{default:l(()=>[t("div",Ee,[T(y.$slots,"actions")])]),_:3})]),_:3}))}},Fe={key:0,class:"text-center text-disabled py-3"},Oe={class:"pa-3 pt-6"},je={class:"d-flex align-items justify-end",style:{background:"#f7f7f708"}},Me={key:2},Ge={class:"px-3"},ze={class:"d-flex align-items justify-end",style:{background:"#f7f7f708"}},Le={__name:"loop",props:{modelValue:{type:[Array],default:()=>[]},itemTitle:{type:[String],default:"name"},default:{type:[Object],default:()=>({})},accordion:{type:[Boolean],default:!0}},emits:["update:modelValue"],setup(h,{expose:c,emit:f}){const y=h,m=f,g=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,_=>(_^crypto.getRandomValues(new Uint8Array(1))[0]&15>>_/4).toString(16)),i=Q({focus:!1,data:y.modelValue,add(){const _=g();i.data.push(i.focus={uid:_,...y.default}),m("update:modelValue",i.data)},delete(_){if(!confirm("Delete item?"))return;const $=i.data.indexOf(_);i.data.splice($,1),m("update:modelValue",i.data),i.focus&&i.focus==_.uid&&(i.focus=!1)}}),p=(_={})=>({add:i.add,delete:i.delete,..._});return c({add:i.add,delete:i.delete}),(_,$)=>(u(),V("div",null,[i.data.length==0?(u(),V("div",Fe,"Nenhum item criado")):S("",!0),y.accordion?(u(),R(Y,{key:1,modelValue:i.focus,"onUpdate:modelValue":$[0]||($[0]=r=>i.focus=r),static:!0,variant:"accordion"},{default:l(()=>[(u(!0),V(I,null,q(i.data,(r,b)=>(u(),R(K,{title:r[y.itemTitle]||`Item #${b+1}`,value:r,rounded:"0",elevation:"0"},{default:l(()=>[e(X,{style:{margin:"-8px -24px -16px"}},{default:l(()=>[t("div",Oe,[T(_.$slots,"item",O(j(p({item:r,index:b}))))]),e(W,{defaults:{VBtn:{rounded:0}}},{default:l(()=>[t("div",je,[e(k,{text:"Remove",color:"red","prepend-icon":"mdi-delete",onClick:n=>i.delete(r)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["title","value"]))),256))]),_:3},8,["modelValue"])):S("",!0),y.accordion?S("",!0):(u(),V("div",Me,[(u(!0),V(I,null,q(i.data,(r,b)=>(u(),V("div",Ge,[T(_.$slots,"item",O(j(p({item:r,index:b}))))]))),256))])),e(W,{defaults:{VBtn:{rounded:0}}},{default:l(()=>[t("div",ze,[T(_.$slots,"actions",O(j(p())))])]),_:3})]))}},We={__name:"money",props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup(h,{emit:c}){const f=h,y=c,m=r=>Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(r).replace(" €",""),g=P({get:()=>m(f.modelValue),set:r=>{p&&(p.masked.value=_.value,p.updateOptions($),p._onChange(),r=parseFloat((r||"").replace(/[^0-9]/g,""))/100,y("update:modelValue",r))}}),i=Z(null);let p,_,$={mask(r){this._value=m((r||"").replace(/[^0-9]/g,"")/100)}};return ee(()=>{const r=i.value.$el;_=r.tagName=="INPUT"?r:r.querySelector("input"),p=te(_,$)}),(r,b)=>(u(),R(B,{modelValue:g.value,"onUpdate:modelValue":b[0]||(b[0]=n=>g.value=n),ref_key:"inputRef",ref:i},null,8,["modelValue"]))}},Qe=t("br",null,null,-1),He=t("div",{class:"ms-2 d-none d-md-block"},"Share",-1),Je=t("div",{class:"ms-2 d-none d-md-block"},"Copiar URL",-1),Ke=t("br",null,null,-1),Xe=t("p",null," Colaboradores podem ajudar a editar gastos e pessoas. Insira o e-mail do colaborador e ao acessar esta página, ele poderá editar. ",-1),Ye=t("br",null,null,-1),Ze=t("colgroup",null,[t("col",{width:"*"}),t("col",{width:"100"})],-1),et=t("td",{class:"text-right"},"Total:",-1),tt=t("br",null,null,-1),at=t("br",null,null,-1),lt=t("br",null,null,-1),st={class:"pa-6",style:{position:"fixed",bottom:"0",right:"0","z-index":"9"}},nt={class:"d-flex flex-column",style:{gap:"10px"}},ot={__name:"index",props:{uid:{type:[String],default:""}},emits:["update:modelValue","saved"],async setup(h,{emit:c}){let f,y;const m=h,g=c,i={inst:ye(),getRef(d){return this.inst.ctx.$refs[d]}},p=Q({value:"info",set(d){this.value=d}}),_=Q({items:[{text:"Info",bind:{icon:"material-symbols:info-outline",onClick:()=>p.set("info"),active:P(()=>p.value=="info")}},{text:"Pessoas",bind:{icon:"material-symbols:frame-person",onClick:()=>p.set("users"),active:P(()=>p.value=="users")}},{text:"Gastos",bind:{icon:"solar:chat-round-money-outline",onClick:()=>p.set("purchases"),active:P(()=>p.value=="purchases")}}]}),$=he({legacy:!0}),r=be(),b=ge(),n=xe({data:{uid:!1,ownerUID:b.user.uid,name:"",users:[],purchases:[],admins:[]},url:location.href,focus:!1,preventSnap:!1,async onSubmit(){this.preventSnap=!0,g("saved",await b.firestore.save("division",this.data)),setTimeout(()=>{this.preventSnap=!1},1e3)},uid(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,d=>(d^crypto.getRandomValues(new Uint8Array(1))[0]&15>>d/4).toString(16))},canEdit(){return b.user?!!(n.data.ownerUID==b.user.uid||n.data.admins.filter(d=>d.email==b.user.email)):!1},async load(){if(!isNaN(m.uid))return;const d=await b.firestore.find("division",m.uid);n.fill({...n.data,...d}),b.firestore.onSnapshot("division",m.uid,s=>{this.preventSnap||n.fill({...n.data,...s.data()})})},async userAdd(){const d=this.uid(),s=`Pessoa #${this.data.users.length+1}`;this.data.users.push(this.focus={uid:d,name:s})},async userRemove(d){if(!confirm(`Remover ${d.name}?`))return;const s=this.data.users.indexOf(d);this.data.users.splice(s,1)},async purchaseAdd(){const d=this.uid(),s=`Item #${this.data.purchases.length+1}`;this.data.purchases.push(this.focus={uid:d,name:s,amount:0,quantity:1,divideBy:[]})},async purchaseRemove(d){if(!confirm(`Remover ${d.name}?`))return;const s=this.data.purchases.indexOf(d);this.data.purchases.splice(s,1)},async adminAdd(){const d=this.uid();this.data.admins.push({uid:d,email:""})},async adminRemove(d){if(!confirm(`Remover ${d.email}?`))return;const s=this.data.admins.indexOf(d);this.data.admins.splice(s,1)},result:P(()=>{let d={total:0};return d.total=n.data.purchases.reduce((s,U)=>s+U.amount*U.quantity,0),d.division=n.data.users.map(s=>{const U=n.data.purchases.filter(x=>x.divideBy.includes(s.uid)).map(x=>({total:x.amount*x.quantity/x.divideBy.length,purchase:x}));return{total:U.reduce((x,A)=>x+A.total,0),user:s,purchases:U}}),d})});return[f,y]=ae(()=>n.load()),await f,y(),(d,s)=>{const U=Pe,w=De,x=Le,A=We;return u(),V(I,null,[o(n).canEdit()?S("",!0):(u(),R(U,{key:0,form:o(n)},null,8,["form"])),o(n).canEdit()?(u(),R(_e,{key:1,onSubmit:s[11]||(s[11]=fe(a=>o(n).submit(),["prevent"]))},{default:l(()=>[e(le,null,{default:l(()=>[o(n).success?(u(),R(se,{key:0,type:"success",class:"mb-6"},{default:l(()=>[M("Dados salvos")]),_:1})):S("",!0)]),_:1}),e(ne,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=a=>p.value=a),class:"mx-1"},{default:l(()=>[e(oe,null,{default:l(()=>[e(G,{editable:!0,type:"button","edit-icon":"mdi-check",value:"info",subtitle:"Info"}),e(H),e(G,{editable:!0,type:"button","edit-icon":"mdi-check",value:"users",subtitle:"Pessoas"}),e(H),e(G,{editable:!0,type:"button","edit-icon":"mdi-check",value:"purchases",subtitle:"Gastos"})]),_:1})]),_:1},8,["modelValue"]),Qe,e(de,{modelValue:p.value,"onUpdate:modelValue":s[10]||(s[10]=a=>p.value=a)},{default:l(()=>[e(z,{value:"info"},{default:l(()=>[e(w,{subtitle:"Informações Principais"},{default:l(()=>[e(B,{modelValue:o(n).data.name,"onUpdate:modelValue":s[1]||(s[1]=a=>o(n).data.name=a),label:"Nome do evento"},null,8,["modelValue"])]),actions:l(()=>[o(r).isSupported?(u(),R(k,{key:0,color:"success",onClick:s[2]||(s[2]=a=>o(r).share({title:o(n).data.name,url:""}))},{default:l(()=>[e(J,{icon:"material-symbols:share"}),He]),_:1})):S("",!0),e(k,{color:o($).copied.value?"success":null,onClick:s[3]||(s[3]=a=>o($).copy(o(n).url))},{default:l(()=>[e(J,{icon:o($).copied.value?"mdi-check":"material-symbols:content-copy-outline"},null,8,["icon"]),Je]),_:1},8,["color"]),e(ie),e(k,{type:"submit",text:"Salvar","prepend-icon":"mdi-check",class:"bg-primary",loading:o(n).busy},null,8,["loading"])]),_:1}),Ke,e(w,{subtitle:"Colaboradores","card-text":!1},{default:l(()=>[e(F,null,{default:l(()=>[Xe]),_:1}),e(x,{modelValue:o(n).data.admins,"onUpdate:modelValue":s[4]||(s[4]=a=>o(n).data.admins=a),ref:"adminsRef","item-title":"email",accordion:!1,default:{email:""}},{item:l(a=>[e(B,{modelValue:a.item.email,"onUpdate:modelValue":v=>a.item.email=v,label:"E-mail","append-inner-icon":"mdi-delete","onClick:appendInner":v=>a.delete(a.item)},null,8,["modelValue","onUpdate:modelValue","onClick:appendInner"])]),_:1},8,["modelValue"])]),actions:l(()=>[e(k,{text:"Add","prepend-icon":"mdi-plus",onClick:s[5]||(s[5]=a=>i.getRef("adminsRef").add())}),e(k,{type:"submit",text:"Salvar","prepend-icon":"mdi-check",class:"bg-primary",loading:o(n).busy},null,8,["loading"])]),_:1})]),_:1}),e(z,{value:"users"},{default:l(()=>[e(w,{subtitle:"Pessoas","card-text":!1},{default:l(()=>[e(F,null,{default:l(()=>[M(" Gerencie todas as pessoas que participarão da divisão ")]),_:1}),e(x,{modelValue:o(n).data.users,"onUpdate:modelValue":s[6]||(s[6]=a=>o(n).data.users=a),ref:"usersRef","item-title":"name",accordion:!1,default:{name:""}},{item:l(a=>[e(B,{modelValue:a.item.name,"onUpdate:modelValue":v=>a.item.name=v,label:"Nome","append-inner-icon":"mdi-delete","onClick:appendInner":v=>a.delete(a.item)},null,8,["modelValue","onUpdate:modelValue","onClick:appendInner"])]),_:1},8,["modelValue"])]),actions:l(()=>[e(k,{text:"Add","prepend-icon":"mdi-plus",onClick:s[7]||(s[7]=a=>i.getRef("usersRef").add())}),e(k,{type:"submit",text:"Salvar","prepend-icon":"mdi-check",class:"bg-primary",loading:o(n).busy},null,8,["loading"])]),_:1})]),_:1}),e(z,{value:"purchases"},{default:l(()=>[e(w,{subtitle:"Gastos","card-text":!1},{default:l(()=>[e(F,null,{default:l(()=>[M(" Informe todos os itens que serão consumidos. ")]),_:1}),e(x,{modelValue:o(n).data.purchases,"onUpdate:modelValue":s[8]||(s[8]=a=>o(n).data.purchases=a),ref:"purchasesRef","item-title":"name",default:{name:"",amount:0,quantity:1,divideBy:[]}},{item:l(a=>[e(ue,null,{default:l(()=>[e(E,{cols:"12"},{default:l(()=>[e(B,{modelValue:a.item.name,"onUpdate:modelValue":v=>a.item.name=v,"hide-details":!0,label:"Nome"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(E,{cols:"12",md:"8"},{default:l(()=>[e(A,{modelValue:a.item.amount,"onUpdate:modelValue":v=>a.item.amount=v,"hide-details":!0,label:"Valor",reverse:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(E,{cols:"12",md:"4"},{default:l(()=>[e(B,{modelValue:a.item.quantity,"onUpdate:modelValue":v=>a.item.quantity=v,"hide-details":!0,label:"Quandidade","prepend-inner-icon":"mdi-minus","append-inner-icon":"mdi-plus","onClick:prependInner":v=>a.item.quantity=Math.max(1,a.item.quantity-1),"onClick:appendInner":v=>a.item.quantity=a.item.quantity+1},null,8,["modelValue","onUpdate:modelValue","onClick:prependInner","onClick:appendInner"])]),_:2},1024),e(E,{cols:"12"},{default:l(()=>[e(re,{modelValue:a.item.divideBy,"onUpdate:modelValue":v=>a.item.divideBy=v,label:"Consumido por",multiple:"",items:o(n).data.users,"item-value":"uid","item-title":"name","hide-details":!0},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])]),actions:l(()=>[e(k,{text:"Add","prepend-icon":"mdi-plus",onClick:s[9]||(s[9]=a=>i.getRef("purchasesRef").add())}),e(k,{type:"submit",text:"Salvar","prepend-icon":"mdi-check",class:"bg-primary",loading:o(n).busy},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Ye,e(w,{subtitle:"Resultado","card-text":!1},{default:l(()=>[e(L,null,{default:l(()=>[Ze,t("tbody",null,[(u(!0),V(I,null,q(o(n).result.division,a=>(u(),V("tr",null,[t("td",null,C(a.user.name),1),t("td",null,[t("small",null,C(("format"in d?d.format:o(N)).money(a.total)),1)])]))),256)),t("tr",null,[et,t("td",null,[t("small",null,C(("format"in d?d.format:o(N)).money(o(n).result.total)),1)])])])]),_:1})]),_:1}),tt,at,lt,t("div",st,[e(me,{location:"top right",offset:"10","close-on-content-click":!1},{activator:l(a=>[e(k,ce({icon:"mdi-dots-horizontal"},a.props,{color:"success"}),null,16)]),default:l(()=>[t("div",nt,[(u(!0),V(I,null,q(_.items,a=>(u(),R(pe,{text:a.text},{activator:l(v=>[e(k,O(j({...a.bind,...v.props})),null,16)]),_:2},1032,["text"]))),256))])]),_:1})])]),_:1})):S("",!0)],64)}}},ct={__name:"[id]",setup(h){const c=ve(),f=Ve();return(y,m)=>{const g=ot,i=ke;return u(),R(i,{name:"app"},{main:l(()=>[e(g,{uid:o(c).params.id,onSaved:m[0]||(m[0]=p=>o(f).push(`/division/${p.uid}`))},null,8,["uid"])]),_:1})}}};export{ct as default};
