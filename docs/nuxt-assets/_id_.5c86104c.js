import{K as O,r as G,L,M as Q,o,u as y,V as k,A as z,B as H,N as J,w as a,b as t,z as K,y as W,E as X,v as s,F as Y,d as f,q as g,J as $,G as P,c as _,O as U,P as R,H as F,I as S,x as I,Q as q,a as c,t as V,R as Z,S as A,T as E,U as D,W as M,X as v,Y as j,Z as ee}from"./entry.34e3a29b.js";import{_ as te}from"./nuxt-layout.18a6ddaf.js";import{u as ae}from"./useFirebase.ea57036b.js";import{u as le}from"./useForm.e089d215.js";const ne={__name:"money",props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup(B,{emit:r}){const p=B,x=r,b=l=>Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(l).replace(" €",""),C=O({get:()=>b(p.modelValue),set:l=>{n&&(n.masked.value=h.value,n.updateOptions(N),n._onChange(),l=parseFloat((l||"").replace(/[^0-9]/g,""))/100,x("update:modelValue",l))}}),i=G(null);let n,h,N={mask(l){this._value=b((l||"").replace(/[^0-9]/g,"")/100)}};return L(()=>{const l=i.value.$el;h=l.tagName=="INPUT"?l:l.querySelector("input"),n=Q(h,N)}),(l,u)=>(o(),y(k,{modelValue:C.value,"onUpdate:modelValue":u[0]||(u[0]=m=>C.value=m),ref_key:"inputRef",ref:i},null,8,["modelValue"]))}};class T{static money(r,p="BRL",x="pt-BR"){return typeof r=="string"&&(r=parseInt(r.replace(/[^0-9]/g,""))/100),isNaN(r)&&(r=0),Intl.NumberFormat(x,{style:"currency",currency:p}).format(r)}static date(r){return r}static timeago(r){return r}}const se={key:0,class:"text-center bg-grey-lighten-4 py-3 text-disabled rounded"},ue=c("br",null,null,-1),de={key:0,class:"text-center bg-grey-lighten-4 py-3 text-disabled rounded"},oe=c("br",null,null,-1),re=c("br",null,null,-1),ie={key:0,class:"d-flex mb-6"},me={class:"pa-3 text-right mb-2 elevation-1 rounded"},ce={class:"font-weight-bold"},ye={__name:"[id]",props:{modelValue:{type:[String],default:""}},emits:["update:modelValue"],async setup(B,{emit:r}){let p,x;const b=z(),C=H(),i=ae(),n=le({data:{uid:!1,ownerUID:i.user.uid,name:"",users:[],purchases:[]},async onSubmit(){const l=await i.firestore.save("division",this.data);C.push(`/division/${l.uid}`)},uid(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,l=>(l^crypto.getRandomValues(new Uint8Array(1))[0]&15>>l/4).toString(16))},focus:!1,async userAdd(){const l=this.uid(),u=`Pessoa #${this.data.users.length+1}`;this.data.users.push(this.focus={uid:l,name:u})},async userRemove(l){if(!confirm(`Remover ${l.name}?`))return;const u=this.data.users.indexOf(l);this.data.users.splice(u,1)},async purchaseAdd(){const l=this.uid(),u=`Item #${this.data.purchases.length+1}`;this.data.purchases.push(this.focus={uid:l,name:u,amount:0,quantity:1,divideBy:[]})},async purchaseRemove(l){if(!confirm(`Remover ${l.name}?`))return;const u=this.data.purchases.indexOf(l);this.data.purchases.splice(u,1)},result:O(()=>{let l={total:0};return l.total=n.data.purchases.reduce((u,m)=>u+m.amount*m.quantity,0),l.division=n.data.users.map(u=>{const m=n.data.purchases.filter(e=>e.divideBy.includes(u.uid)).map(e=>({total:e.amount*e.quantity/e.divideBy.length,purchase:e}));return{total:m.reduce((e,d)=>e+d.total,0),user:u,purchases:m}}),l})});if(b.params.id!="new"){const l=([p,x]=J(()=>i.firestore.find("division",b.params.id)),p=await p,x(),p);n.fill(l)}const h={readonly:!i.user},N={VTextField:h,VSelect:h,VTextarea:h};return(l,u)=>{const m=ne,w=te;return o(),y(w,{name:"app"},{main:a(()=>[t(Z,{defaults:N},{default:a(()=>[t(K,{onSubmit:u[4]||(u[4]=W(e=>s(n).submit(),["prevent"]))},{default:a(()=>[t(X,null,{default:a(()=>[s(n).success?(o(),y(Y,{key:0,type:"success",class:"mb-6"},{default:a(()=>[f("Dados salvos")]),_:1})):g("",!0)]),_:1}),t(k,{label:"Nome do evento",modelValue:s(n).data.name,"onUpdate:modelValue":u[0]||(u[0]=e=>s(n).data.name=e)},null,8,["modelValue"]),t($,{title:"Pessoas"},{default:a(()=>[t(P,{class:"d-flex flex-column",style:{gap:"20px"}},{default:a(()=>[s(n).data.users.length==0?(o(),_("div",se," Nenhuma pessoa criada ")):g("",!0),(o(!0),_(R,null,U(s(n).data.users,e=>(o(),y(k,{modelValue:e.name,"onUpdate:modelValue":d=>e.name=d,label:"Nome do participante","hide-details":!0,"append-inner-icon":s(i).user?"mdi-delete":null,"onClick:appendInner":d=>s(n).userRemove(e)},null,8,["modelValue","onUpdate:modelValue","append-inner-icon","onClick:appendInner"]))),256))]),_:1}),s(i).user?(o(),y(F,{key:0},{default:a(()=>[t(S),t(I,{onClick:u[1]||(u[1]=e=>s(n).userAdd())},{default:a(()=>[f("Nova Pessoa")]),_:1})]),_:1})):g("",!0)]),_:1}),ue,t($,{title:"Gastos"},{default:a(()=>[t(P,null,{default:a(()=>[s(n).data.purchases.length==0?(o(),_("div",de," Nenhum gasto criado ")):g("",!0),t(q,{modelValue:s(n).focus,"onUpdate:modelValue":u[2]||(u[2]=e=>s(n).focus=e)},{default:a(()=>[(o(!0),_(R,null,U(s(n).data.purchases,e=>(o(),y(A,{value:e},{default:a(()=>[t(E,null,{default:a(()=>[f(V(e.name),1)]),_:2},1024),t(D,null,{default:a(()=>[oe,t(M,null,{default:a(()=>[t(v,{cols:"12"},{default:a(()=>[t(k,{modelValue:e.name,"onUpdate:modelValue":d=>e.name=d,label:"Produto","hide-details":!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(v,{cols:"8"},{default:a(()=>[t(m,{modelValue:e.amount,"onUpdate:modelValue":d=>e.amount=d,label:"Preço","hide-details":!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(v,{cols:"4"},{default:a(()=>[t(k,{modelValue:e.quantity,"onUpdate:modelValue":d=>e.quantity=d,modelModifiers:{number:!0},label:"Quant.",type:"number","hide-details":!0,"prepend-inner-icon":s(i).user?"mdi-minus":null,"append-inner-icon":s(i).user?"mdi-plus":null,"onClick:prependInner":d=>e.quantity=Math.max(1,e.quantity-1),"onClick:appendInner":d=>e.quantity++},null,8,["modelValue","onUpdate:modelValue","prepend-inner-icon","append-inner-icon","onClick:prependInner","onClick:appendInner"])]),_:2},1024),t(v,{cols:"12"},{default:a(()=>[t(j,{modelValue:e.divideBy,"onUpdate:modelValue":d=>e.divideBy=d,label:"Quem vai consumir?",multiple:"",items:s(n).data.users,"item-value":"uid","item-title":"name","hide-details":!0},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(v,{cols:"12"},{default:a(()=>[t(I,{color:"error",onClick:d=>s(n).purchaseRemove(e),"prepend-icon":"mdi-delete"},{default:a(()=>[f("Deletar")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),s(i).user?(o(),y(F,{key:0},{default:a(()=>[t(S),t(I,{onClick:u[3]||(u[3]=e=>s(n).purchaseAdd())},{default:a(()=>[f("Novo Gasto")]),_:1})]),_:1})):g("",!0)]),_:1}),re,s(i).user?(o(),_("div",ie,[t(S),t(I,{type:"submit",color:"success","prepend-icon":"mdi-check",loading:s(n).busy},{default:a(()=>[f("Salvar")]),_:1},8,["loading"])])):g("",!0),t($,{title:"Resultados"},{default:a(()=>[t(P,null,{default:a(()=>[c("div",me,"Total: "+V(s(n).result.total),1),t(q,null,{default:a(()=>[(o(!0),_(R,null,U(s(n).result.division,e=>(o(),y(A,null,{default:a(()=>[t(E,null,{default:a(()=>[t(M,null,{default:a(()=>[t(v,{cols:"6"},{default:a(()=>[f(V(e.user.name),1)]),_:2},1024),t(v,{cols:"6"},{default:a(()=>[f(V(s(T).money(e.total)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(D,{style:{margin:"-6px -24px -14px"}},{default:a(()=>[t(ee,null,{default:a(()=>[c("tbody",null,[(o(!0),_(R,null,U(e.purchases,d=>(o(),_("tr",null,[c("td",null,V(d.purchase.name),1),c("td",null,V(s(T).money(d.purchase.amount)),1),c("td",null,"/ "+V(d.purchase.divideBy.length),1),c("td",ce,"= "+V(s(T).money(d.total)),1)]))),256))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};export{ye as default};
