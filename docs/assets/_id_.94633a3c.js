import{c as F,r as D,o as I,M,t as i,L as y,V as g,N as L,O,u as Q,A as t,z as a,P as G,Q as o,R as z,B as r,S as W,T as R,U as S,W as N,v as b,X as x,Y as U,Z as B,_ as $,$ as k,a0 as w,x as c,y as p,a1 as X,a2 as Y,a3 as P,a4 as T,a5 as E,a6 as A,a7 as _,a8 as Z,a9 as j}from"./entry.017a5878.js";import{_ as H}from"./nuxt-layout.a0b9db2d.js";import{u as J}from"./useFirebase.f1844adf.js";const K={__name:"money",props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],setup(V,{emit:h}){const m=V,C=h,f=e=>Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e).replace(" €",""),s=F({get:()=>f(m.modelValue),set:e=>{l&&(l.masked.value=d.value,l.updateOptions(v),l._onChange(),e=parseFloat((e||"").replace(/[^0-9]/g,""))/100,C("update:modelValue",e))}}),u=D(null);let l,d,v={mask(e){this._value=f((e||"").replace(/[^0-9]/g,"")/100)}};return I(()=>{const e=u.value.$el;d=e.tagName=="INPUT"?e:e.querySelector("input"),l=M(d,v)}),(e,n)=>(i(),y(g,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=q=>s.value=q),ref_key:"inputRef",ref:u},null,8,["modelValue"]))}},ee=(V={})=>{V={data:{uid:!1,name:""},onSubmit:()=>null,onError:m=>console.error(m),onLoad:()=>null,...V};const h=L({ready:!1,busy:!1,success:!1,error:!1,response:!1,async submit(){this.busy=!0,this.error=!1,this.success=!1;try{this.response=await this.onSubmit()||!0,this.success=!0}catch(m){this.error=this.onError(m)||!0}this.busy=!1},async fill(m={}){h.data=m},...V});return I(()=>{h.onLoad()}),h},ae=c("br",null,null,-1),te=c("br",null,null,-1),le=c("br",null,null,-1),se={class:"d-flex"},ue=c("br",null,null,-1),ne={class:"bg-white pa-3 text-right mb-2 elevation-1 rounded"},oe={class:"text-disabled"},me={__name:"[id]",props:{modelValue:{type:[String],default:""}},emits:["update:modelValue"],setup(V,{emit:h}){const m=O(),C=Q(),f=J(),s=ee({data:{uid:!1,ownerUID:!1,name:"",users:[],purchases:[]},async onSubmit(){const u=await f.firestore.save("division",this.data);C.push(`/division/${u.uid}`)},uid(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,u=>(u^crypto.getRandomValues(new Uint8Array(1))[0]&15>>u/4).toString(16))},focus:!1,async userAdd(){const u=this.uid(),l=`Pessoa #${this.data.users.length+1}`;this.data.users.push(this.focus={uid:u,name:l})},async userRemove(u){if(!confirm(`Remover ${u.name}?`))return;const l=this.data.users.indexOf(u);this.data.users.splice(l,1)},async purchaseAdd(){const u=this.uid(),l=`Item #${this.data.purchases.length+1}`;this.data.purchases.push(this.focus={uid:u,name:l,amount:0,quantity:1,divideBy:[]})},async purchaseRemove(u){if(!confirm(`Remover ${u.name}?`))return;const l=this.data.purchases.indexOf(u);this.data.purchases.splice(l,1)},result:F(()=>{let u={total:0};return u.total=s.data.purchases.reduce((l,d)=>l+d.amount*d.quantity,0),u.division=s.data.users.map(l=>{const d=s.data.purchases.filter(e=>e.divideBy.includes(l.uid)).map(e=>({total:e.amount*e.quantity/e.divideBy.length,purchase:e}));return{total:d.reduce((e,n)=>e+n.total,0),user:l,purchases:d}}),u})});return f.on("onAuthStateChanged",async()=>{if(m.params.id!="new"){const u=await f.firestore.find("division",m.params.id);s.fill(u)}s.data.ownerUID=f.user.uid}),(u,l)=>{const d=K,v=H;return i(),y(v,{name:"auth"},{main:t(()=>[a(Y,{onSubmit:l[4]||(l[4]=X(e=>o(s).submit(),["prevent"]))},{default:t(()=>[a(G,null,{default:t(()=>[o(s).success?(i(),y(z,{key:0,type:"success",class:"mb-6"},{default:t(()=>[r("Dados salvos")]),_:1})):W("",!0)]),_:1}),a(g,{label:"Nome do evento",modelValue:o(s).data.name,"onUpdate:modelValue":l[0]||(l[0]=e=>o(s).data.name=e)},null,8,["modelValue"]),ae,a(R,{color:"grey-lighten-3"},{default:t(()=>[a(S,null,{default:t(()=>[r("Pessoas")]),_:1}),a(N,{class:"d-flex flex-column",style:{gap:"20px"}},{default:t(()=>[(i(!0),b(U,null,x(o(s).data.users,e=>(i(),y(g,{modelValue:e.name,"onUpdate:modelValue":n=>e.name=n,label:"Nome do participante","append-inner-icon":"mdi-delete","onClick:appendInner":n=>o(s).userRemove(e)},null,8,["modelValue","onUpdate:modelValue","onClick:appendInner"]))),256))]),_:1}),a(B,null,{default:t(()=>[a($),a(k,{onClick:l[1]||(l[1]=e=>o(s).userAdd())},{default:t(()=>[r("Nova Pessoa")]),_:1})]),_:1})]),_:1}),te,a(R,{color:"grey-lighten-3"},{default:t(()=>[a(S,null,{default:t(()=>[r("Gastos")]),_:1}),a(N,null,{default:t(()=>[a(w,{modelValue:o(s).focus,"onUpdate:modelValue":l[2]||(l[2]=e=>o(s).focus=e)},{default:t(()=>[(i(!0),b(U,null,x(o(s).data.purchases,e=>(i(),y(P,{value:e},{default:t(()=>[a(T,null,{default:t(()=>[r(p(e.name),1)]),_:2},1024),a(E,null,{default:t(()=>[a(A,null,{default:t(()=>[a(_,{cols:"12"},{default:t(()=>[a(g,{modelValue:e.name,"onUpdate:modelValue":n=>e.name=n,label:"Produto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(_,{cols:"8"},{default:t(()=>[a(d,{modelValue:e.amount,"onUpdate:modelValue":n=>e.amount=n,label:"Preço"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(_,{cols:"4"},{default:t(()=>[a(g,{modelValue:e.quantity,"onUpdate:modelValue":n=>e.quantity=n,modelModifiers:{number:!0},label:"Quant.",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(_,{cols:"12"},{default:t(()=>[a(Z,{modelValue:e.divideBy,"onUpdate:modelValue":n=>e.divideBy=n,label:"Quem vai consumir?",multiple:"",items:o(s).data.users,"item-value":"uid","item-title":"name"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),a(_,{cols:"12"},{default:t(()=>[a(k,{color:"error",onClick:n=>o(s).purchaseRemove(e),"prepend-icon":"mdi-delete"},{default:t(()=>[r("Deletar")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(B,null,{default:t(()=>[a($),a(k,{onClick:l[3]||(l[3]=e=>o(s).purchaseAdd())},{default:t(()=>[r("Novo Gasto")]),_:1})]),_:1})]),_:1}),le,c("div",se,[a($),a(k,{type:"submit",color:"success","prepend-icon":"mdi-check",loading:o(s).busy},{default:t(()=>[r("Salvar")]),_:1},8,["loading"])]),ue,a(R,{color:"grey-lighten-3"},{default:t(()=>[a(S,null,{default:t(()=>[r("Resultados")]),_:1}),a(N,null,{default:t(()=>[c("div",ne,"Total: "+p(o(s).result.total),1),a(w,null,{default:t(()=>[(i(!0),b(U,null,x(o(s).result.division,e=>(i(),y(P,null,{default:t(()=>[a(T,null,{default:t(()=>[a(A,null,{default:t(()=>[a(_,{cols:"6"},{default:t(()=>[r(p(e.user.name),1)]),_:2},1024),a(_,{cols:"6"},{default:t(()=>[r(p(e.total),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(E,null,{default:t(()=>[a(j,null,{default:t(()=>[c("tbody",null,[(i(!0),b(U,null,x(e.purchases,n=>(i(),b("tr",null,[c("td",null,p(n.purchase.name),1),c("td",null,p(n.total),1),c("td",oe,p(n.purchase.amount)+" / "+p(n.purchase.divideBy.length),1)]))),256))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};export{me as default};
